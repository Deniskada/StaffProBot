# Техническая документация SPBot

## 1. Общее описание системы

### 1.1 Назначение
SPBot - система управления сменами, предназначенная для автоматизации процессов учета рабочего времени сотрудников и управления объектами.

### 1.2 Архитектура
Система построена на основе MVC-архитектуры с использованием:
- PHP 7.4+
- MySQL 5.7+
- Bootstrap 5
- JavaScript/AJAX

### 1.3 Структура каталогов 
spbot/
├── config/ # Конфигурационные файлы
├── controllers/ # Контроллеры
├── core/ # Ядро системы
├── migrations/ # Миграции БД
├── models/ # Модели
├── public/ # Публичные файлы
├── views/ # Представления
└── logs/ # Логи

## 2. Компоненты системы

### 2.1 Ядро (Core)
- **App.php** - основной класс приложения
- **Router.php** - маршрутизация запросов
- **Controller.php** - базовый контроллер
- **Model.php** - базовая модель
- **View.php** - система шаблонов
- **Database.php** - работа с БД
- **Request.php** - обработка запросов
- **Session.php** - управление сессиями
- **Validator.php** - валидация данных
- **ErrorHandler.php** - обработка ошибок
- **Logger.php** - система логирования
- **JWT.php** - работа с токенами
- **TelegramAPI.php** - интеграция с Telegram
- **PaymentGateway.php** - платежная система
- **Mailer.php** - отправка email
- **Cache.php** - кэширование
- **FileUploader.php** - загрузка файлов

### 2.2 Модели
- **User.php** - пользователи системы
- **Employee.php** - сотрудники
- **Facility.php** - объекты
- **Shift.php** - смены
- **Plan.php** - тарифные планы
- **Subscription.php** - подписки
- **Payment.php** - платежи
- **Notification.php** - уведомления
- **SystemLog.php** - системные логи

### 2.3 Контроллеры
- **AuthController.php** - авторизация
- **DashboardController.php** - панели управления
- **UserController.php** - управление пользователями
- **FacilityController.php** - управление объектами
- **ShiftController.php** - управление сменами
- **PaymentController.php** - обработка платежей
- **NotificationController.php** - уведомления
- **ApiController.php** - API интерфейс

## 3. База данных

### 3.1 Структура таблиц
- users
- facilities
- shifts
- plans
- subscriptions
- payments
- notifications
- notification_templates
- system_logs

### 3.2 Миграции
Система использует миграции для управления структурой БД:
php
php migrate.php

## 4. API

### 4.1 REST API
Система предоставляет REST API для интеграции:
- /api/shifts
- /api/facilities
- /api/employees
- /api/payments

### 4.2 Telegram API
Интеграция с Telegram ботом:
- Webhook обработчик
- Команды бота
- Уведомления

## 5. Безопасность

### 5.1 Аутентификация
- Сессии
- JWT токены
- CSRF защита

### 5.2 Авторизация
- Роли пользователей
- Права доступа
- Middleware

### 5.3 Валидация
- Входные данные
- Файлы
- API запросы

## 6. Конфигурация

### 6.1 Основные настройки
php
config/config.php


### 6.2 Окружения
- Development
- Production
- Testing

### 6.3 Переменные окружения
.env

## 7. Развертывание

### 7.1 Требования
- PHP 7.4+
- MySQL 5.7+
- Composer
- Apache/Nginx

### 7.2 Установка
1. Клонирование репозитория
2. Установка зависимостей
3. Настройка окружения
4. Миграции БД
5. Настройка веб-сервера

### 7.3 Обновление
- Процедура обновления
- Откат изменений
- Резервное копирование

## 8. Мониторинг

### 8.1 Логирование
- Системные логи
- Логи ошибок
- Логи доступа

### 8.2 Отчеты
- Статистика использования
- Отчеты по сменам
- Финансовые отчеты

## 9. Расширение системы

### 9.1 Создание новых модулей
- Структура модуля
- Интеграция
- Тестирование

### 9.2 Кастомизация
- Темы оформления
- Локализация
- Настройка уведомлений

Composer.json
Основные зависимости:
vlucas/phpdotenv - для работы с .env файлами
phpmailer/phpmailer - для отправки email
firebase/php-jwt - для работы с JWT токенами
phpoffice/phpword - для генерации ODT документации
Расширения PHP:
ext-pdo - для работы с базой данных
ext-json - для работы с JSON
Dev-зависимости:
phpunit - для тестирования
symfony/var-dumper - для отладки
Автозагрузку классов:
PSR-4 автозагрузчик для namespace Spbot
Конфигурацию:
optimize-autoloader - для оптимизации автозагрузки
sort-packages - для сортировки пакетов